{% extends "spbase.html" %}
{% block content %}
<style>
    .slab-cell {
        background-color: #f8f9fa !important;  /* Light gray background for slab cells */
    }
    .specimen-row-even {
        background-color: #f8f9fa;  /* Light gray for even rows */
    }
    .specimen-row-odd {
        background-color: #ffffff;  /* White for odd rows */
    }
    .table-divider {
        height: 2px;
        background-color: #dee2e6;
    }
    .badge-image-count {
        background-color: #17a2b8;
        color: white;
        border-radius: 10px;
        padding: 2px 6px;
        font-size: 0.75rem;
    }
    /* Set fixed column widths */
    .col-slab {
        width: 13%;
    }
    .col-specimen {
        width: 15%;
    }
    .col-taxon {
        width: 25%;
    }
    .col-phylum {
        width: 15%;
    }
    .col-images {
        width: 7%;
        text-align: center;
    }
    .col-horizon {
        width: 10%;
    }
    .col-remarks {
        width: 15%;
    }
    /* Make table cells maintain their width */
    .table th, .table td {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
</style>

<h4 class="bd-title p-2 bg-secondary text-light">Specimen List</h4>
<table class="table table-sm">
    <thead>
    <tr><td colspan="5" align="left">
     {{ page_obj.start_index }}-{{ page_obj.end_index }} out of {{ page_obj.paginator.count }} 
    </td><td colspan="2" align="right">
        <form method="GET" action="{% url 'siriuspasset:specimen_list'%}">
            {% csrf_token %}
            <select name="filter2" id="filter2">
                <option value="" {% if filter2 == "" %}selected{%endif%}>All</option>
            </select>
            <input type="text" size="30" name="filter1" value="{{filter1|default_if_none:''}}"><button type="submit">Search</button>
        </form>
    </td></tr>
    </thead>
    {% if grouped_specimens %}   
    <tbody>
        <tr>
            <th class="col-slab"><div>Slab no.</div></th>
            <th class="col-specimen"><div>Specimen no.</div></th>
            <th class="col-taxon"><div>Taxon name</div></th>
            <th class="col-phylum"><div>Phylum</div></th>
            <th class="col-images"><div>Images</div></th>
            <th class="col-horizon"><div>Horizon</div></th>
            <th class="col-remarks"><div>Remarks</div></th>
        </tr>
        {% for group in grouped_specimens %}
            {% for specimen in group.specimens %}
                <tr class="tr_link {% if forloop.counter0|divisibleby:2 %}specimen-row-even{% else %}specimen-row-odd{% endif %}" style="cursor:pointer;" data-href="{% url 'siriuspasset:specimen_detail' specimen.id %}">
                    {% if forloop.first %}
                        <td class="slab-cell col-slab" rowspan="{{ group.specimens|length }}">
                            <a href="{% url 'siriuspasset:slab_detail' group.slab.id %}" class="font-weight-bold" style="text-decoration: none; color: #007bff;">{{ group.slab.slab_no|default_if_none:'' }}</a>
                            {% if group.slab_only_image_count > 0 %}
                                <span class="badge badge-image-count" title="Slab-only images">{{ group.slab_only_image_count }}</span>
                            {% endif %}
                            <div class="mt-1">
                                <a href="{% url 'siriuspasset:add_specimen' %}?slab_id={{ group.slab.id }}" class="btn btn-sm btn-outline-primary">+ Add Specimen</a>
                            </div>
                        </td>
                    {% endif %}
                    <td class="col-specimen"><a href="{% url 'siriuspasset:specimen_detail' specimen.id %}">{{ specimen.specimen_no }}</a></td>
                    <td class="col-taxon">{{ specimen.taxon_name|default_if_none:'' }}</td>
                    <td class="col-phylum">{{ specimen.phylum|default_if_none:'' }}</td>
                    <td class="col-images">
                        {% if specimen.image_count > 0 %}
                            <span class="badge badge-image-count">{{ specimen.image_count }}</span>
                        {% else %}
                            <span class="text-muted">0</span>
                        {% endif %}
                    </td>
                    <td class="col-horizon">{{ specimen.slab.horizon|default_if_none:'' }}</td>
                    <td class="col-remarks">{{ specimen.remarks|default_if_none:'' }}</td>
                </tr>
            {% endfor %}
            {% if not forloop.last %}
                <tr>
                    <td colspan="7" class="table-divider"></td>
                </tr>
            {% endif %}
        {% endfor %}
    {% else %}
        <tr><td colspan="7">No specimens are available.</td></tr>
    {% endif %}
    </tbody>
    <tfooter>
        <tr><td colspan="4" width="400" align="right">
            {% include "nkfpaginator.html" %}
        </td><td colspan="3" width="400" align="right">
            <a href="{% url 'siriuspasset:add_specimen' %}">[Add specimen]</a>
        </td></tr>
    </tfooter>
</table>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const rows = document.querySelectorAll('tr[data-href]');
    rows.forEach(row => {
        row.addEventListener('click', function() {
            window.location.href = this.dataset.href;
        });
    });
});
</script>
{% endblock %}